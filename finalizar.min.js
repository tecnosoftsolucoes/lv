$((function(){function BuscaPagamentosBoletos(){$.post("/pagto/cartaoparcelamento",{tipo:2,subtotal:$("#valprodutos").val(),frete:$("#valfrete").val(),desconto:$("#valdesconto").val()}).done((function(data){-1==data?alert("Nenhum Plano de Pagamento foi encontrado"):-9==data?($(".expirada").removeClass("d-none"),$("#valprodutos").val("0"),$("#valdesconto").val("0"),$("#subtotal").html("<strong>0,00</strong>"),$("#frete").text("0,00"),$("#valfrete").val("0,00"),$("#total").html("<strong>0,00</strong>")):(htmlSel='<option value="" disabled selected>Selecione o parcelamento desejado</option>',jQuery.each(data,(function(index,plano){htmlSel+='<option value="'+plano.ID_PLANO+"#"+plano.PRAZO+"#"+plano.FINANCEIRO+'">'+plano.DESCRICAO+" de R$ "+plano.PARCELA+(plano.PARCELAS>1?" (Total a Prazo R$"+plano.TOTAL+")":"")+"</option>"})),$("#BOL_PARCELAS").html(htmlSel))}))}function BuscaValorPix(){$.post("/pagto/cartaoparcelamento",{tipo:3,subtotal:$("#valprodutos").val(),frete:$("#valfrete").val(),desconto:$("#valdesconto").val()}).done((function(data){-1==data?alert("Nenhum Plano de Pagamento foi encontrado"):-9==data?($(".expirada").removeClass("d-none"),$("#valprodutos").val("0"),$("#valdesconto").val("0"),$("#subtotal").html("<strong>0,00</strong>"),$("#frete").text("0,00"),$("#valfrete").val("0,00"),$("#total").html("<strong>0,00</strong>")):0==data.length?Alert("Nenhum plano de pagamento foi selecionado para o PIX (Configuração do Administrador)"):(plano=data[0],$("#id_plano").val(plano.ID_PLANO),$("#prazo").val(plano.PRAZO),$("#financeiro").val(plano.FINANCEIRO),$("#parcelas").val(1),total=$("#valtotal").val().replace(".","").replace(",","."),jurdesc=Number(total)*plano.FINANCEIRO/100,$("#jur_desc").val(jurdesc),$("#valorTotalPix").html("Valor do Pedido no PIX R$ "+plano.TOTAL))}))}function camposCartaoDesativar(){$("#CART_NAME").attr("disabled",!0),$("#CART_MES").attr("disabled",!0),$("#CART_ANO").attr("disabled",!0),$("#CART_CSV").attr("disabled",!0),$("#CART_TYPE").attr("disabled",!0),$("#CART_PARCELAS").attr("disabled",!0)}function camposCartaoAtivar(){$("#CART_NAME").attr("disabled",!1),$("#CART_MES").attr("disabled",!1),$("#CART_ANO").attr("disabled",!1),$("#CART_CSV").attr("disabled",!1),$("#CART_TYPE").attr("disabled",!1),$("#CART_PARCELAS").attr("disabled",!1)}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),window.matchMedia("(min-width: 760px)").matches||$("#navbarDepartamentos").removeClass("btn-group").addClass("btn-group-vertical"),$(document).on("click","#btnValidaDesconto",(function(){$("#radioPix").prop("checked",!1),$("#radioCartao").prop("checked",!1),$("#radioBoleto").prop("checked",!1),$("#BOL_PARCELAS").html(""),$("#CART_PARCELAS").html(""),$("#valdesconto").val("0"),$("#subtotal").html("<strong>0,00</strong>"),$("#frete").text("0,00"),$("#valfrete").val("0.00"),$("#prazo").val(""),$("#financeiro").val(""),$("#jur_desc").val(""),$("#id_plano").val(""),$("#parcelas").val(""),$("#valorTotalPix").html(""),$("#btConcluirCompra").attr("disabled",!0),$.post("/cesta/verificacupom",{cupom:$("#cupomdesconto").val(),subtotal:$("#valprodutos").val(),frete:$("#valfrete").val()}).done((function(data){1==$("#analytics_OK").length&&gtag("event","set_checkout_option",{checkout_step:2,checkout_option:"Cupom Desconto",value:data.DESCRICAO}),""==data.DESCRICAO?($("#valordesconto").html("- "+data.DESCONTO),$("#valdesconto").val(data.DESC),$("#descricaodesconto").val($("#cupomdesconto").val())):($("#valordesconto").html(data.DESCRICAO),$("#valdesconto").val("0"),$("#descricaodesconto").val("")),$("#total").html("<strong>"+data.TOTAL+"</strong>")}))})),$(document).on("change",".parcelamento",(function(){pag=$(this).val().split("#"),parc=pag[1].split("|"),$("#id_plano").val(pag[0]),$("#prazo").val(pag[1]),$("#financeiro").val(pag[2]),$("#parcelas").val(parc.length-1),total=$("#valtotal").val().replace(".","").replace(",","."),jurdesc=Number(total)*pag[2]/100,$("#jur_desc").val(jurdesc),$("#BLOQUEAFINALIZACAO").length>0||$.post("/cesta/totalizadores",{id_plano:pag[0],prazo:pag[1],financeiro:pag[2],parcelas:parc.length-1}).done((function(data){1==data?$("#btConcluirCompra").attr("disabled",!1):$("#btConcluirCompra").attr("disabled",!0),$body.removeClass("loadingfinalizacao")})).fail((function(data){$body.removeClass("loadingfinalizacao"),$("#btConcluirCompra").attr("disabled",!0)}))})),$("#tipoCartao").length>0&&($("#tipoCartao").fadeOut(1),$("#parcelamentoCartao").fadeOut(1)),0==$("#pagtoCartao").length&&$("#pagtoBoleto").length>0&&BuscaPagamentosBoletos(),$(document).on("click",".radiobuttonpagto",(function(){const tipo=$(this).val();$("#id_plano").val(""),$("#prazo").val(""),$("#financeiro").val(""),$("#parcelas").val(""),$("#BOL_PARCELAS").html(""),$("#CART_PARCELAS").html(""),$("#valorTotalPix").html(""),$("#btConcluirCompra").attr("disabled",!0),1==tipo?($("#pagtoCartao").attr("disabled",!1),$("#pagtoBoleto").attr("disabled",!0)):2==tipo?($("#pagtoBoleto").attr("disabled",!1),$("#pagtoCartao").attr("disabled",!0),BuscaPagamentosBoletos()):3==tipo?(BuscaValorPix(),$("#pagtoBoleto").attr("disabled",!0),$("#pagtoCartao").attr("disabled",!0),$("#BLOQUEAFINALIZACAO").length>0||$("#btConcluirCompra").attr("disabled",!1)):console.log("não selecionou forma de pagto")})),$(document).ready((function(){$("#CART_NAME").attr("disabled",!0),$("#CART_MES").attr("disabled",!0),$("#CART_ANO").attr("disabled",!0),$("#CART_CSV").attr("disabled",!0),$("#CART_TYPE").attr("disabled",!0),$("#CART_PARCELAS").attr("disabled",!0)})),$(document).on("change","#CART_NUMBER",(function(){16==$("#CART_NUMBER").val().length&&0==$("#CART_BRAND").val().length&&$.get("/pagto/cartao/"+$("#CART_NUMBER").val()).done((function(data){if(""==data)16==$("#CART_NUMBER").length&&$("#CART_NUMBER").addClass("is-invalid");else if(-9999==data)$("#CART_NUMBER").addClass("is-invalid");else{if(""!=data){$("#CART_BRAND").val(data);var bandeira=data;bandeira=bandeira.toString().toLowerCase(),$("#"+bandeira).length>0?$("#"+bandeira).attr("src","/img/cartoes/"+bandeira+".png"):$("#outro").attr("src","/img/cartoes/outros.png")}htmlSel='<option value="" disabled selected>Selecione</option>',htmlSel+='<option value="1">Crédito</option>',$("#CART_TYPE").html(htmlSel),$("#tipoCartao").fadeIn("fast")}}))})),$(document).on("keyup","#CART_NUMBER",(function(){16==$("#CART_NUMBER").val().length&&camposCartaoAtivar(),$("#CART_NUMBER").removeClass("is-invalid");var arrNumeros=["Enter","Backspace","Tab","1","2","3","4","5","6","7","8","9","0"];-1===$.inArray(event.key,arrNumeros)?($("#tipoCartao").fadeOut("fast"),event.preventDefault()):"Backspace"==event.key?($("#CART_PARCELAS").val("").attr("disabled",!0),$("#CART_BRAND").val().length>0&&(camposCartaoDesativar(),$("#btConcluirCompra").attr("disabled",!0),bandeira=$("#CART_BRAND").val().toString().toLowerCase(),$("#"+bandeira).length>0?$("#"+bandeira).attr("src","/img/cartoes/"+bandeira+"_.png"):$("#outro").attr("src","/img/cartoes/outros_.png"),$("#tipoCartao").fadeOut("fast"),$("#CART_BRAND").val(""))):$("#CART_NUMBER").val().length>=2&&0==$("#CART_BRAND").val().length&&$.get("/pagto/cartao/"+$("#CART_NUMBER").val()).done((function(data){""==data?($(".alert-num-cartao-erro").removeClass("d-none").addClass("d-flex").text("Numero do cartão invalido!"),$("#CART_NUMBER").attr("maxlength",2),camposCartaoDesativar(),16==$("#CART_NUMBER").length&&$("#CART_NUMBER").addClass("is-invalid")):-9999==data?($("#CART_NUMBER").addClass("is-invalid"),$(".alert-num-cartao-erro").removeClass("d-none").addClass("d-flex").text("Numero do cartão invalido!"),$("#CART_NUMBER").attr("maxlength",2),camposCartaoDesativar()):(""!=data&&($(".alert-num-cartao-erro").removeClass("d-flex").addClass("d-none"),$("#CART_NUMBER").attr("maxlength",16),$("#CART_BRAND").val(data),bandeira=data.toString().toLowerCase(),$("#"+bandeira).length>0?$("#"+bandeira).attr("src","/img/cartoes/"+bandeira+".png"):$("#outro").attr("src","/img/cartoes/outros.png")),htmlSel='<option value="" disabled selected>Selecione</option>',htmlSel+='<option value="1">Crédito</option>',$("#CART_TYPE").html(htmlSel),$("#tipoCartao").fadeIn("fast"))}))})),$(document).on("change","#CART_TYPE",(function(){""==$("#CART_NAME").val().length||""==$("#CART_MES").val()||""==$("#CART_ANO").val()||""==$("#CART_CSV").val().length?($("#CART_PARCELAS").attr("disabled",!0),$("#CART_TYPE").val("")):$("#CART_PARCELAS").attr("disabled",!1),$.post("/pagto/cartaoparcelamento",{tipo:1,subtotal:$("#valprodutos").val(),frete:$("#valfrete").val(),desconto:$("#valdesconto").val()}).done((function(data){-1==data?alert("Nenhum Plano de Pagamento foi encontrado"):(htmlSel='<option value="" disabled selected>Selecione o parcelamento desejado</option>',jQuery.each(data,(function(index,plano){htmlSel+='<option value="'+plano.ID_PLANO+"#"+plano.PRAZO+"#"+plano.FINANCEIRO+'">'+plano.DESCRICAO+" de R$ "+plano.PARCELA+(plano.PARCELAS>1?" (Total a Prazo R$"+plano.TOTAL+")":"")+"</option>"})),$("#CART_PARCELAS").html(htmlSel),$("#parcelamentoCartao").fadeIn("fast"))}))})),$(document).on("keyup","#CART_NAME",(function(){""!=$("#CART_NAME").val().length&&$(".alert-nome-cartao-erro").removeClass("d-flex").addClass("d-none")})),$(document).on("change","#CART_MES",(function(){null!=$("#CART_MES").val()&&$(".alert-mes-cartao-erro").removeClass("d-flex").addClass("d-none")})),$(document).on("change","#CART_ANO",(function(){null!=$("#CART_ANO").val()&&$(".alert-ano-cartao-erro").removeClass("d-flex").addClass("d-none")})),$(document).on("keyup","#CART_CSV",(function(){""!=$("#CART_CSV").val().length&&$(".alert-csv-cartao-erro").removeClass("d-flex").addClass("d-none")})),$(document).on("click","#btConcluirCompra",(function(){1==$("#radioCartao").is(":checked")&&(""==$("#CART_NAME").val().length||null==$("#CART_MES").val()||null==$("#CART_ANO").val()||""==$("#CART_CSV").val().length)?(""==$("#CART_NAME").val().length&&$(".alert-nome-cartao-erro").removeClass("d-none").addClass("d-flex").text("Nome não foi digitado!"),null==$("#CART_MES").val()&&$(".alert-mes-cartao-erro").removeClass("d-none").addClass("d-flex").text("Mês não selecionado!"),null==$("#CART_ANO").val()&&$(".alert-ano-cartao-erro").removeClass("d-none").addClass("d-flex").text("Ano não selecionado!"),""==$("#CART_CSV").val().length&&$(".alert-csv-cartao-erro").removeClass("d-none").addClass("d-flex").text("Código de segurança inválido!"),$("#btConcluirCompra").attr("disabled",!0),$("#CART_TYPE").val(""),$("#CART_PARCELAS").val("")):($("#btConcluirCompra").attr("disabled",!1),$body.addClass("loadingfinalizacao"),3!=$("#PROD_SEM_ESTOQUE").val()?$.get("/cesta/verificaestoque").done((function(data){1==data?$("#formularioFinalizar").submit():($body.removeClass("loadingfinalizacao"),$("#modalAvisoTitulo").html("Estoque Insuficiente!"),$("#modalAvisoDescricao").html("Nosso sistema identificou que no exato momento de conclusão da sua compra, algum(ns) item(ns) não possuiam estoque disponível, por favor clique no botão abaixo e verifique as alterações de quantidade necessárias para conclusão do Pedido."),$("#modalAvisoConcluir").modal("show"))})).fail((function(data){$body.removeClass("loadingfinalizacao"),$("#modalAvisoTitulo").html("Verificação de Estoque!"),$("#modalAvisoDescricao").html("Ocorreu uma falha na verificação de estoque, por favor clique no botão abaixo para verificar se existe alguma pendência de estoque."),$("#modalAvisoConcluir").modal("show")})):$("#formularioFinalizar").submit())}))}));